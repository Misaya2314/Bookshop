<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<t-navbar title="æˆ‘çš„è®¢å•" />

<!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
<view class="order-tabs">
  <t-tabs value="{{currentTab}}" bind:change="onTabChange">
    <t-tab-panel 
      wx:for="{{tabList}}" 
      wx:key="_id"
      label="{{item.label}}" 
      value="{{item.value}}"
    />
  </t-tabs>
</view>

<!-- è®¢å•åˆ—è¡¨ -->
<scroll-view scroll-y class="orders-container" refresher-enabled="{{true}}" bind:refresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
  <view class="order-list">
    <!-- è®¢å•é¡¹ -->
    <view 
      class="order-item" 
      wx:for="{{orders}}" 
      wx:key="_id"
      bindtap="goToOrderDetail"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="merchant-info">
          <t-icon name="shop" size="32rpx" color="#3b82f6" />
          <text class="merchant-name">{{item.merchantName}}</text>
        </view>
        <view class="order-status {{item.statusClass}}">
          {{item.statusText}}
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="order-products">
        <view 
          class="product-item" 
          wx:for="{{item.products}}" 
          wx:key="_id"
          wx:for-item="product"
        >
          <view class="product-image">
            <text class="book-emoji">{{product.icon}}</text>
          </view>
          <view class="product-info">
            <text class="product-title">{{product.title}}</text>
            <text class="product-desc">{{product.description}}</text>
            <view class="product-footer">
              <text class="product-price">Â¥{{product.price}}</text>
              <text class="product-quantity">x{{product.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•åº•éƒ¨ä¿¡æ¯ -->
      <view class="order-footer">
        <view class="order-info">
          <text class="order-time">{{item.createTime}}</text>
          <text class="order-total">å…±{{item.totalQuantity}}ä»¶å•†å“ åˆè®¡: Â¥{{item.totalPrice}}</text>
        </view>
        <view class="order-actions">
          <!-- æ ¹æ®è®¢å•çŠ¶æ€æ˜¾ç¤ºä¸åŒæ“ä½œæŒ‰é’® -->
          <t-button 
            wx:if="{{item.status === 'pending'}}"
            size="small" 
            theme="primary" 
            bind:tap="payOrder"
            data-id="{{item._id}}"
            catch:tap="true"
          >
            ç«‹å³æ”¯ä»˜
          </t-button>
          <t-button 
            wx:if="{{item.status === 'pending'}}"
            size="small" 
            variant="outline" 
            bind:tap="cancelOrder"
            data-id="{{item._id}}"
            catch:tap="true"
            style="margin-left: 16rpx;"
          >
            å–æ¶ˆè®¢å•
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'shipping'}}"
            size="small" 
            variant="outline" 
            bind:tap="contactSeller"
            data-id="{{item._id}}"
            catch:tap="true"
          >
            è”ç³»å–å®¶
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'receiving'}}"
            size="small" 
            theme="primary" 
            bind:tap="confirmReceive"
            data-id="{{item._id}}"
            catch:tap="true"
          >
            ç¡®è®¤æ”¶è´§
          </t-button>
          <t-button 
            wx:if="{{item.status === 'receiving'}}"
            size="small" 
            variant="outline" 
            bind:tap="viewLogistics"
            data-id="{{item._id}}"
            catch:tap="true"
            style="margin-left: 16rpx;"
          >
            æŸ¥çœ‹ç‰©æµ
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'completed'}}"
            size="small" 
            theme="primary" 
            bind:tap="writeReview"
            data-id="{{item._id}}"
            catch:tap="true"
          >
            è¯„ä»·
          </t-button>
          <t-button 
            wx:if="{{item.status === 'completed'}}"
            size="small" 
            variant="outline" 
            bind:tap="buyAgain"
            data-id="{{item._id}}"
            catch:tap="true"
            style="margin-left: 16rpx;"
          >
            å†æ¬¡è´­ä¹°
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'review'}}"
            size="small" 
            theme="primary" 
            bind:tap="writeReview"
            data-id="{{item._id}}"
            catch:tap="true"
          >
            å†™è¯„ä»·
          </t-button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-orders" wx:if="{{orders.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— {{currentTabLabel}}è®¢å•</text>
    <text class="empty-desc">å»çœ‹çœ‹æœ‰ä»€ä¹ˆå¥½ä¹¦å§</text>
    <t-button 
      theme="primary" 
      size="large" 
      bind:tap="goShopping"
      style="margin-top: 40rpx; width: 400rpx;"
    >
      å»é€›é€›
    </t-button>
  </view>
</scroll-view> 