<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<t-navbar title="æˆ‘çš„è®¢å•">
  <view slot="left" class="navbar-left" bindtap="goBack">
    <t-icon name="chevron-left" size="44rpx" />
  </view>
</t-navbar>

<!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
<view class="order-tabs">
  <t-tabs value="{{currentTab}}" bind:change="onTabChange">
    <t-tab-panel 
      wx:for="{{tabs}}" 
      wx:key="value"
      label="{{item.label}}{{item.count > 0 ? ' (' + item.count + ')' : ''}}" 
      value="{{item.value}}"
    />
  </t-tabs>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <t-loading theme="spinner" size="40rpx" />
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>

<!-- è®¢å•åˆ—è¡¨ -->
<scroll-view scroll-y class="orders-container" wx:if="{{!loading}}" refresher-enabled="{{true}}" bind:refresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
  <view class="order-list">
    <!-- è®¢å•é¡¹ -->
    <view 
      class="order-item" 
      wx:for="{{orders}}" 
      wx:key="_id"
      bindtap="goToOrderDetail"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="merchant-info">
          <t-icon name="shop" size="32rpx" color="#3b82f6" />
          <text class="merchant-name">{{item.merchantName}}</text>
        </view>
        <view class="order-status {{item.statusClass}}">
          {{item.statusText}}
          <!-- å¾…æ”¯ä»˜è®¢å•æ˜¾ç¤ºå€’è®¡æ—¶ -->
          <view wx:if="{{item.status === 'pending' && item.remainingTime}}" class="countdown">
            <text class="countdown-text">å‰©ä½™: {{item.remainingTime}}</text>
          </view>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="order-products">
        <view 
          class="product-item" 
          wx:for="{{item.products}}" 
          wx:key="_id"
          wx:for-item="product"
        >
          <view class="product-image">
            <text class="book-emoji">{{product.icon}}</text>
          </view>
          <view class="product-info">
            <text class="product-title">{{product.title}}</text>
            <text class="product-desc">{{product.description}}</text>
            <view class="product-footer">
              <text class="product-price">Â¥{{product.price}}</text>
              <text class="product-quantity">x{{product.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•åº•éƒ¨ä¿¡æ¯ -->
      <view class="order-footer">
        <view class="order-info">
          <text class="order-time">{{item.createTime}}</text>
          <text class="order-total">å…±{{item.totalQuantity}}ä»¶å•†å“ åˆè®¡: Â¥{{item.totalPrice}}</text>
        </view>
        <view class="order-actions">
          <!-- æ ¹æ®è®¢å•çŠ¶æ€æ˜¾ç¤ºä¸åŒæ“ä½œæŒ‰é’® -->
          <t-button 
            wx:if="{{item.status === 'pending'}}"
            size="small" 
            theme="primary" 
            catchtap="payOrder"
            data-id="{{item._id}}"
          >
            ç«‹å³æ”¯ä»˜
          </t-button>
          <t-button 
            wx:if="{{item.status === 'pending'}}"
            size="small" 
            variant="outline" 
            catchtap="cancelOrder"
            data-id="{{item._id}}"
            style="margin-left: 16rpx;"
          >
            å–æ¶ˆè®¢å•
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'paid'}}"
            size="small" 
            variant="outline" 
            catchtap="contactSeller"
            data-id="{{item._id}}"
          >
            è”ç³»å–å®¶
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'shipping'}}"
            size="small" 
            theme="primary" 
            catchtap="confirmReceive"
            data-id="{{item._id}}"
          >
            ç¡®è®¤æ”¶è´§
          </t-button>
          <t-button 
            wx:if="{{item.status === 'shipping'}}"
            size="small" 
            variant="outline" 
            catchtap="viewLogistics"
            data-id="{{item._id}}"
            style="margin-left: 16rpx;"
          >
            æŸ¥çœ‹ç‰©æµ
          </t-button>
          
          <t-button 
            wx:if="{{item.status === 'completed'}}"
            size="small" 
            theme="primary" 
            catchtap="writeReview"
            data-id="{{item._id}}"
          >
            è¯„ä»·
          </t-button>
          <t-button 
            wx:if="{{item.status === 'completed'}}"
            size="small" 
            variant="outline" 
            catchtap="buyAgain"
            data-id="{{item._id}}"
            style="margin-left: 16rpx;"
          >
            å†æ¬¡è´­ä¹°
          </t-button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-orders" wx:if="{{orders.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— {{currentTabLabel}}è®¢å•</text>
    <text class="empty-desc">å»çœ‹çœ‹æœ‰ä»€ä¹ˆå¥½ä¹¦å§</text>
    <t-button 
      theme="primary" 
      size="large" 
      bind:tap="goShopping"
      style="margin-top: 40rpx; width: 400rpx;"
    >
      å»é€›é€›
    </t-button>
  </view>
</scroll-view> 