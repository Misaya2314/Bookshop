<!-- 顶部导航栏 -->
<t-navbar title="我的收藏" />

<view class="favorites-container">
  <!-- 未登录引导界面 -->
  <view class="login-guide" wx:if="{{!isLoggedIn}}">
    <view class="guide-content">
      <view class="guide-icon">💗</view>
      <text class="guide-title">查看收藏需要登录</text>
      <text class="guide-desc">登录后查看您收藏的书籍</text>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="goToLogin"
        class="login-btn"
      >
        立即登录
      </t-button>
      <view class="browse-tip">
        <text>您也可以继续浏览商品</text>
        <text class="browse-link" bindtap="goToBrowse"> 去逛逛 →</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading && isLoggedIn}}">
    <text>加载中...</text>
  </view>

  <!-- 收藏列表 -->
  <scroll-view scroll-y class="favorites-scroll" wx:if="{{!loading && isLoggedIn}}">
    <view class="favorites-list">
      <view 
        class="favorite-item" 
        wx:for="{{favorites}}" 
        wx:key="id"
        bindtap="goToDetail"
        data-id="{{item.bookId}}"
      >
        <view class="book-image">
          <image 
            class="book-img" 
            src="{{item.images && item.images[0] || ''}}" 
            wx:if="{{item.images && item.images[0]}}"
            mode="aspectFill"
          />
          <text class="book-emoji" wx:else>{{item.icon}}</text>
        </view>
        <view class="book-info">
          <text class="book-title">{{item.title}}</text>
          <view class="book-footer">
            <text class="book-price">¥{{item.price}}</text>
            <text class="original-price" wx:if="{{item.originalPrice}}">¥{{item.originalPrice}}</text>
          </view>
          <text class="favorite-time">收藏于 {{item.createTime}}</text>
        </view>
        <view class="favorite-actions">
          <t-icon 
            name="heart-filled" 
            size="48rpx" 
            color="#ff4757" 
            bind:tap="removeFavorite"
            data-book-id="{{item.bookId}}"
            data-index="{{index}}"
          />
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="loading-more" wx:if="{{loadingMore}}">
      <text>加载中...</text>
    </view>

    <!-- 没有更多数据 -->
    <view class="no-more" wx:if="{{!hasMore && favorites.length > 0}}">
      <view class="no-more-content">
        <text class="no-more-icon">💝</text>
        <text class="no-more-text">没有更多收藏了</text>
        <text class="no-more-tip">已为您展示全部收藏</text>
      </view>
    </view>

    <!-- 空状态（已登录但无收藏） -->
    <view class="empty-state" wx:if="{{!loading && isLoggedIn && favorites.length === 0}}">
      <view class="empty-content">
        <text class="empty-icon">💔</text>
        <text class="empty-title">还没有收藏任何图书</text>
        <text class="empty-desc">去首页看看有什么好书吧</text>
        <t-button theme="primary" size="medium" bind:tap="goToBrowse">
          去首页逛逛
        </t-button>
      </view>
    </view>
  </scroll-view>
</view> 