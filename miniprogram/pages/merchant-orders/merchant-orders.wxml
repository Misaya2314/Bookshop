<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<t-navbar title="è®¢å•ç®¡ç†">
  <view slot="left" class="navbar-left" bindtap="goBack">
    <t-icon name="chevron-left" size="44rpx" />
  </view>
</t-navbar>

<!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
<view class="order-tabs">
  <t-tabs value="{{currentTab}}" bind:change="onTabChange">
    <t-tab-panel 
      wx:for="{{tabs}}" 
      wx:key="value"
      label="{{item.labelWithCount}}" 
      value="{{item.value}}"
    />
  </t-tabs>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <t-loading theme="spinner" size="40rpx" />
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>

<!-- è®¢å•åˆ—è¡¨ -->
<scroll-view 
  scroll-y 
  class="orders-container" 
  wx:if="{{!loading}}" 
  refresher-enabled="{{true}}" 
  bind:refresherrefresh="onRefresh" 
  refresher-triggered="{{refreshing}}"
>
  <view class="order-list">
    <!-- è®¢å•é¡¹ -->
    <view 
      class="order-item" 
      wx:for="{{orders}}" 
      wx:key="_id"
      bindtap="viewOrderDetail"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="buyer-info">
          <t-icon name="user" size="32rpx" color="#3b82f6" />
          <text class="buyer-name">{{item.buyerName || 'ä¹°å®¶'}}</text>
        </view>
        <view class="order-status {{item.statusClass}}">
          {{item.statusText}}
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="order-products">
        <view 
          class="product-item" 
          wx:for="{{item.products}}" 
          wx:key="_id"
          wx:for-item="product"
        >
          <view class="product-image">
            <image 
              wx:if="{{product.images && product.images.length > 0}}"
              src="{{product.images[0]}}" 
              class="book-image" 
              mode="aspectFill"
            />
            <text wx:else class="book-emoji">{{product.icon || 'ğŸ“š'}}</text>
          </view>
          <view class="product-info">
            <text class="product-title">{{product.title}}</text>
            <text class="product-desc">{{product.description}}</text>
            <view class="product-footer">
              <text class="product-price">Â¥{{product.price}}</text>
              <text class="product-quantity">x{{product.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info">
        <view class="order-detail">
          <text class="order-time">{{item.createTime}}</text>
          <text class="order-address">{{item.deliveryAddress}}</text>
        </view>
        <text class="order-total">å…±{{item.totalQuantity}}ä»¶å•†å“ åˆè®¡: Â¥{{item.totalPrice}}</text>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions">
        <!-- å¾…å‘è´§çŠ¶æ€ -->
        <block wx:if="{{item.status === 'paid'}}">
          <t-button 
            size="small" 
            variant="outline" 
            catchtap="contactBuyer"
            data-id="{{item._id}}"
          >
            è”ç³»ä¹°å®¶
          </t-button>
          <t-button 
            size="small" 
            theme="primary" 
            catchtap="shipOrder"
            data-id="{{item._id}}"
            style="margin-left: 16rpx;"
          >
            ç«‹å³å‘è´§
          </t-button>
        </block>
        
        <!-- å·²å‘è´§çŠ¶æ€ -->
        <block wx:if="{{item.status === 'shipping'}}">
          <t-button 
            size="small" 
            variant="outline" 
            catchtap="contactBuyer"
            data-id="{{item._id}}"
          >
            è”ç³»ä¹°å®¶
          </t-button>
        </block>
        
        <!-- å·²å®ŒæˆçŠ¶æ€ -->
        <block wx:if="{{item.status === 'completed'}}">
          <t-button 
            size="small" 
            variant="outline" 
            catchtap="contactBuyer"
            data-id="{{item._id}}"
          >
            è”ç³»ä¹°å®¶
          </t-button>
        </block>
        
        <!-- å…¶ä»–çŠ¶æ€æ˜¾ç¤ºæŸ¥çœ‹è¯¦æƒ… -->
        <block wx:if="{{item.status !== 'paid' && item.status !== 'shipping' && item.status !== 'completed'}}">
          <t-button 
            size="small" 
            variant="outline"
            catchtap="viewOrderDetail"
            data-id="{{item._id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </t-button>
        </block>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-orders" wx:if="{{orders.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— {{currentTabLabel}}è®¢å•</text>
    <text class="empty-desc">ç­‰å¾…ä¹°å®¶ä¸‹å•å§</text>
  </view>
</scroll-view>
