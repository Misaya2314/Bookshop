# 学院分类系统部署指南

## 🎯 功能概述

已成功将图书分类系统从原来的"图书类型分类"（计算机、医学、管理学等）升级为"学院专业分类"系统。新系统支持：

- 17 个学院分类
- 每个学院下的专业子分类
- 动态专业列表加载
- 向后兼容性处理

## 📁 修改文件清单

### 1. 新增文件

- `miniprogram/utils/college-data.ts` - 学院专业数据定义
- `docs/college-major-mapping.md` - 学院专业映射关系文档
- `scripts/migrate-book-categories.md` - 数据迁移指南

### 2. 修改文件

- `miniprogram/pages/category/category.ts` - 分类页面逻辑
- `miniprogram/pages/category/category.wxml` - 分类页面模板
- `miniprogram/pages/merchant-dashboard/merchant-dashboard.ts` - 商家后台逻辑
- `miniprogram/pages/merchant-dashboard/merchant-dashboard.wxml` - 商家后台模板
- `cloudfunctions/books/index.js` - 图书云函数

## 🚀 部署步骤

### 步骤 1: 上传云函数

```bash
# 在微信开发者工具中
1. 右键点击 cloudfunctions/books 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成
```

### 步骤 2: 发布小程序代码

```bash
1. 在微信开发者工具中编译预览
2. 确认功能正常后上传代码
3. 提交审核并发布
```

### 步骤 3: 数据迁移（可选）

如果有现有图书数据，请参考 `scripts/migrate-book-categories.md` 进行数据迁移。

## 🔍 测试验证

### 1. 分类页面测试

- [ ] 左侧学院列表正确显示 17 个学院
- [ ] 点击学院后右侧专业列表正确更新
- [ ] 选择专业后图书列表正确筛选
- [ ] 搜索功能正常工作

### 2. 商家后台测试

- [ ] 添加商品时学院选择器正常
- [ ] 选择学院后专业选择器动态更新
- [ ] 保存商品时分类信息正确存储
- [ ] 编辑商品时分类信息正确回显

### 3. 兼容性测试

- [ ] 新旧数据可以同时存在
- [ ] 搜索功能兼容新旧分类
- [ ] 现有功能不受影响

## 📋 学院专业列表

| 学院 ID | 学院名称             | 图标 | 专业数量 |
| ------- | -------------------- | ---- | -------- |
| 1       | 数学科学学院         | 📊   | 3        |
| 2       | 经济金融学院         | 💰   | 3        |
| 3       | 计算机科学与工程学院 | 💻   | 4        |
| 4       | 车辆工程学院         | 🚗   | 5        |
| 5       | 会计学院             | 📋   | 3        |
| 6       | 电气与电子工程学院   | ⚡   | 5        |
| 7       | 管理学院             | 💼   | 6        |
| 8       | 材料科学与工程学院   | 🧪   | 4        |
| 9       | 药学与生物工程学院   | 💊   | 4        |
| 10      | 语言与传播学院       | 🗣️   | 3        |
| 11      | 机械工程学院         | ⚙️   | 4        |
| 12      | 化学化工学院         | ⚗️   | 3        |
| 13      | 重庆知识产权学院     | 🏛️   | 2        |
| 14      | 两江国际学院         | 🌏   | 1        |
| 15      | 应用技术学院         | 🔧   | 5        |
| 16      | 两江人工智能学院     | 🤖   | 4        |
| 17      | 物理与新能源学院     | 🔋   | 3        |

## 🔧 技术细节

### 数据结构变化

```javascript
// 旧结构
{
  categoryId: 1,        // 图书类型ID
  subCategoryId: "textbook" // 子分类ID
}

// 新结构
{
  collegeId: 3,         // 学院ID
  collegeName: "计算机科学与工程学院",
  majorId: "computer_science_technology", // 专业ID
  majorName: "计算机科学与技术"
}
```

### API 接口变化

```javascript
// 新增云函数接口
wx.cloud.callFunction({
  name: "books",
  data: {
    action: "getBooksByCollege",
    collegeId: 3,
    majorId: "computer_science_technology",
    page: 1,
    pageSize: 20,
  },
});
```

## ⚠️ 注意事项

1. **向后兼容**：新代码支持处理旧的分类数据，但建议逐步迁移
2. **性能优化**：学院专业数据使用静态导入，无需数据库查询
3. **用户体验**：专业列表会根据选择的学院动态更新
4. **数据一致性**：添加商品时会自动填充学院和专业名称

## 🐛 常见问题

### Q: 专业列表不更新？

A: 检查 `college-data.ts` 文件是否正确导入，确认学院 ID 是否匹配。

### Q: 保存商品时报错？

A: 确认云函数已正确部署，检查传递的学院和专业字段是否完整。

### Q: 现有图书显示异常？

A: 可能需要数据迁移，参考迁移文档或联系技术支持。

## 📞 技术支持

如遇到技术问题，请检查：

1. 云函数部署状态
2. 控制台错误日志
3. 网络连接状态
4. 数据格式是否正确

部署完成后，您的小程序将支持按学院和专业进行图书分类，为用户提供更精准的图书查找体验！

