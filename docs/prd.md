校园书商微信小程序需求文档

一、项目概述
项目名称：学长二手书微信小程序
技术平台：微信云开发（CloudBase）
目标用户：在校学生（买家）+ 管理员/商家（卖家）
项目目标：打造一个专为校园服务的图书电商平台，支持专业书籍的分类选购、微信支付、固定校内地址配送。采用简化的权限模型，由单一商家/管理员负责商品管理。
开发过程中使用 TDesign 组件库

二、整体架构
本小程序基于微信云开发平台，利用其提供的云函数、数据库、云存储、身份鉴权等能力，构建完整的前后端一体化服务。

模块划分
✅ 首页（推荐、搜索）
✅ 分类页（按专业分类）
✅ 商品详情页
✅ 购物车页
✅ 订单页（含结算确认页）
✅ 我的（用户中心）
✅ 登录/授权页
✅ 收藏页
🔄 管理后台（商品管理、订单管理、用户管理）

三、功能需求

1. 用户功能模块（买家）- ✅ 已完成
   1.1 登录与授权 ✅

   - 使用微信授权登录，获取用户 openid
   - 首次登录需绑定手机号，选择所在校区与专业
   - 登录后才能进行购买与查看订单等操作

     1.2 首页 ✅

   - 推荐图书展示（按热度、上新、促销排序）
   - 支持关键词搜索书名、作者
   - 轮播图展示热门推荐

     1.3 分类页面 ✅

   - 按照专业进行一级分类：计算机、医学、管理、英语、法律等
   - 二级分类为书籍类型（教材、参考书、考研资料等）
   - 支持分类筛选和排序

     1.4 商品详情 ✅

   - 展示书籍基本信息（名称、作者、出版社、ISBN、价格、库存、简介等）
   - 支持加入购物车、立即购买、收藏功能
   - 商品图片轮播展示

     1.5 购物车 ✅

   - 支持添加、删除、修改商品数量
   - 购物车结算前校验库存
   - 支持全选、批量删除操作

     1.6 提交订单 ✅

   - 结算确认页面，支持从购物车结算和立即购买两种流程
   - 用户选择固定地址（A 校区宿舍 1 号楼、B 校区教学楼前自提点等）
   - 支持备注功能（例如备注送书时间段）
   - 使用微信支付完成支付

     1.7 订单管理 ✅

   - 查看订单状态：待支付、待发货、待收货、已完成、已取消
   - 支持订单倒计时（待支付订单 1 小时自动取消）
   - 可申请取消订单（发货前）
   - 订单详情页面展示完整信息
   - 订单状态实时更新

     1.8 我的页面 ✅

   - 展示头像、昵称、手机号、专业、校区
   - 修改个人信息（专业、地址）
   - 查看订单记录（按状态分类显示数量）
   - 收藏夹管理
   - 实时订单统计数据

     1.9 收藏功能 ✅

   - 商品收藏/取消收藏
   - 收藏列表管理
   - 收藏商品快速加购物车

2. 管理功能模块（管理员/商家）- 🔄 待开发
   2.1 权限模型

   - 简化权限设计：普通用户 vs 管理员
   - 管理员同时具备商家功能
   - 无需复杂的商家申请审核流程

     2.2 商品管理

   - 商品上架、下架、编辑
   - 库存管理、价格调整
   - 商品分类管理
   - 图片上传管理

     2.3 订单管理

   - 查看所有订单
   - 更新发货状态
   - 订单统计分析

     2.4 用户管理

   - 用户信息查看
   - 权限管理

四、收货地址设计 ✅ 已实现
固定地址模型：

- 地址项由平台预设，例如：
  - A 校区一号宿舍楼下
  - A 校区图书馆门口
  - B 校区教学楼前自提点
  - C 校区食堂门口
- 用户仅能从预设列表中选择

地址管理：

- 用户在下单时选择收货地址
- 支持为不同订单选择不同地址

五、微信支付接入 尚未实现
接入微信云开发支付能力（cloud.callFunction + 微信商户平台）。

- 接入微信云开发支付能力
- 支持生成预支付订单 → 微信支付 → 云函数校验支付状态 → 更新订单状态
- 订单超时自动取消机制

六、数据库设计 ✅ 已完成
| 集合名称 | 功能描述 | 状态 |
|---------|---------|------|
| users | 存储用户基本信息（openid、校区、专业、身份） | ✅ |
| books | 存储图书信息、分类、库存等 | ✅ |
| cart | 用户购物车记录 | ✅ |
| orders | 用户订单记录（含完整订单流程） | ✅ |
| favorites | 用户收藏记录 | ✅ |
| address_pool | 预设收货地址列表 | ✅ |

七、角色与权限说明
| 角色 | 权限说明 |
|------|---------|
| 普通用户 | 浏览、下单、支付、查看订单、修改个人信息、收藏商品 |
| 管理员 | 商品管理、订单管理、用户管理、系统配置 |

八、技术实现状态
✅ 已完成功能：

- 用户系统（登录、授权、个人信息管理）
- 商品系统（展示、搜索、分类、详情）
- 购物车系统（增删改查、结算）
- 订单系统（创建、支付、状态管理、倒计时）
- 收藏系统（收藏管理）
- 数据库设计（完整的集合结构）
- 云函数（用户、商品、购物车、订单、收藏相关）

🔄 待开发功能：

- 管理后台界面
- 商品管理功能
- 订单管理后台
- 用户管理后台

九、非功能性需求

- 性能：首页加载 < 3 秒，支付响应时间 < 2 秒
- 安全性：用户数据加密存储，云函数权限配置严格限制访问
- 兼容性：适配主流微信版本与屏幕尺寸
- 用户体验：响应式设计，流畅的交互动画
